
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://enpasos.github.io/jax2onnx/user_guide/api/">
      
      
        <link rel="prev" href="../getting_started/">
      
      
        <link rel="next" href="../stacktrace_metadata/">
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>API Reference - jax2onnx</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#api-reference" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="jax2onnx" class="md-header__button md-logo" aria-label="jax2onnx" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            jax2onnx
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              API Reference
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple"  aria-hidden="true"  type="radio" name="__palette" id="__palette_0">
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/enpasos/jax2onnx" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    enpasos/jax2onnx
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="jax2onnx" class="md-nav__button md-logo" aria-label="jax2onnx" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    jax2onnx
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/enpasos/jax2onnx" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    enpasos/jax2onnx
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    User Guide
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    User Guide
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    API Reference
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    API Reference
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#jax2onnx.user_interface" class="md-nav__link">
    <span class="md-ellipsis">
      
        user_interface
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="user_interface">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#jax2onnx.user_interface.allclose" class="md-nav__link">
    <span class="md-ellipsis">
      
        allclose
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="allclose">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#jax2onnx.user_interface.allclose--1-define-and-export" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Define and Export
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jax2onnx.user_interface.allclose--2-validate" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Validate
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jax2onnx.user_interface.allclose--provide-concrete-shapes-for-validation-replacing-dynamic-dim-b" class="md-nav__link">
    <span class="md-ellipsis">
      
        Provide concrete shapes for validation (replacing dynamic dim 'B')
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jax2onnx.user_interface.onnx_function" class="md-nav__link">
    <span class="md-ellipsis">
      
        onnx_function
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="onnx_function">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#jax2onnx.user_interface.onnx_function--also-works-with-flax-modules" class="md-nav__link">
    <span class="md-ellipsis">
      
        Also works with Flax modules:
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jax2onnx.user_interface.to_onnx" class="md-nav__link">
    <span class="md-ellipsis">
      
        to_onnx
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="to_onnx">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#jax2onnx.user_interface.to_onnx--define-a-simple-jax-function" class="md-nav__link">
    <span class="md-ellipsis">
      
        Define a simple JAX function
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jax2onnx.user_interface.to_onnx--define-input-shapes-b-indicates-a-dynamic-batch-dimension" class="md-nav__link">
    <span class="md-ellipsis">
      
        Define input shapes: 'B' indicates a dynamic batch dimension
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jax2onnx.user_interface.to_onnx--convert-and-save-to-file-directly-recommended" class="md-nav__link">
    <span class="md-ellipsis">
      
        Convert and save to file directly (Recommended)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../stacktrace_metadata/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Stacktrace Metadata
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../supported_components/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Supported Components
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Examples
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_6" >
        
          
          <label class="md-nav__link" for="__nav_2_6" id="__nav_2_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    SotA Examples
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    SotA Examples
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sota_examples/gpt_oss/getting_weights/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    GPT-OSS
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sota_examples/maxtext/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MaxText
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sota_examples/dinov3/getting_weights/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DINOv3
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Developer Guide
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Developer Guide
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developer_guide/architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developer_guide/plugin_system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Plugin System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Advanced Topics
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Advanced Topics
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developer_guide/advanced_topics/complex_numbers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Complex Numbers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developer_guide/advanced_topics/expect_graph_reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Expected Graph Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developer_guide/advanced_topics/ir_optimizer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IR Optimizer
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developer_guide/advanced_topics/ir_reflection_guidelines/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IR Reflection
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developer_guide/advanced_topics/linen_support/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Linen Support
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developer_guide/advanced_topics/onnx_function_usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ONNX Functions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developer_guide/advanced_topics/onnx_ir_builder/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ONNX IR Builder
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developer_guide/advanced_topics/onnx_ir_typing_how_to/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ONNX IR Typing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developer_guide/advanced_topics/subgraph_input_handling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Subgraph Input Handling
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developer_guide/advanced_topics/typing_improvements/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Typing Improvements
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    About
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    About
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../about/roadmap/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Roadmap
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../about/past_versions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Past Versions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../about/contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Contributing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../about/dependencies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dependencies
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../about/license/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    License
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../about/acknowledgements/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Acknowledgements
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#jax2onnx.user_interface" class="md-nav__link">
    <span class="md-ellipsis">
      
        user_interface
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="user_interface">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#jax2onnx.user_interface.allclose" class="md-nav__link">
    <span class="md-ellipsis">
      
        allclose
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="allclose">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#jax2onnx.user_interface.allclose--1-define-and-export" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Define and Export
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jax2onnx.user_interface.allclose--2-validate" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Validate
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jax2onnx.user_interface.allclose--provide-concrete-shapes-for-validation-replacing-dynamic-dim-b" class="md-nav__link">
    <span class="md-ellipsis">
      
        Provide concrete shapes for validation (replacing dynamic dim 'B')
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jax2onnx.user_interface.onnx_function" class="md-nav__link">
    <span class="md-ellipsis">
      
        onnx_function
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="onnx_function">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#jax2onnx.user_interface.onnx_function--also-works-with-flax-modules" class="md-nav__link">
    <span class="md-ellipsis">
      
        Also works with Flax modules:
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jax2onnx.user_interface.to_onnx" class="md-nav__link">
    <span class="md-ellipsis">
      
        to_onnx
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="to_onnx">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#jax2onnx.user_interface.to_onnx--define-a-simple-jax-function" class="md-nav__link">
    <span class="md-ellipsis">
      
        Define a simple JAX function
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jax2onnx.user_interface.to_onnx--define-input-shapes-b-indicates-a-dynamic-batch-dimension" class="md-nav__link">
    <span class="md-ellipsis">
      
        Define input shapes: 'B' indicates a dynamic batch dimension
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jax2onnx.user_interface.to_onnx--convert-and-save-to-file-directly-recommended" class="md-nav__link">
    <span class="md-ellipsis">
      
        Convert and save to file directly (Recommended)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="api-reference">API Reference</h1>


<div class="doc doc-object doc-module">



<h2 id="jax2onnx.user_interface" class="doc doc-heading">
            <code>jax2onnx.user_interface</code>


</h2>

    <div class="doc doc-contents first">

        <p>User-facing API for converting JAX functions and models to ONNX.</p>
<p>This module provides the primary interface for exporting JAX/Flax models to the
ONNX format. It supports dynamic shapes, runtime parameters, and numerical
validation against ONNX Runtime.</p>
<p>Key Functions:</p>
<ul>
<li><strong>to_onnx</strong>: Convert a JAX function or Flax module to an ONNX model.</li>
<li><strong>onnx_function</strong>: Decorator to mark a function or class as an ONNX function node.</li>
<li><strong>allclose</strong>: Validate numerical equivalence between JAX and ONNX Runtime outputs.</li>
</ul>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>from jax2onnx import to_onnx
import jax.numpy as jnp</p>
<p>def my_model(x):
...     return jnp.sin(x)</p>
<p>to_onnx(my_model, inputs=[('B', 10)], return_mode="file", output_path="model.onnx")</p>
</blockquote>
</blockquote>
</blockquote>
</details>







  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="jax2onnx.user_interface.allclose" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">allclose</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">onnx_model_path</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">input_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-05</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">enable_double_precision</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Checks if JAX and ONNX Runtime outputs remain numerically close.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>fn</code>
            </td>
            <td>
                  <code><span title="typing.Callable">Callable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>JAX callable to compare against the exported ONNX model.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>onnx_model_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to a serialized model that ORT can execute.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>inputs</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Concrete input arrays (or shape tuples, which will be sampled).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>input_params</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional keyword arguments applied to both call sites.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rtol</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Relative tolerance for floating-point comparisons.</p>
              </div>
            </td>
            <td>
                  <code>0.001</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>atol</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Absolute tolerance for floating-point comparisons.</p>
              </div>
            </td>
            <td>
                  <code>1e-05</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>enable_double_precision</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Temporarily enable <code>jax_enable_x64</code> while running the
comparison. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>(is_match, message)</code> where <code>is_match</code> indicates success and <code>message</code></p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>provides context when a mismatch occurs.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>import jax.numpy as jnp
from jax2onnx import to_onnx, allclose</p>
<h4 id="jax2onnx.user_interface.allclose--1-define-and-export">1. Define and Export</h4>
<p>def my_func(x):
...     return jnp.sin(x)</p>
<p>model_path = to_onnx(
...     my_func,
...     inputs=[('B', 10)],
...     return_mode="file",
...     output_path="my_model.onnx"
... )</p>
<h4 id="jax2onnx.user_interface.allclose--2-validate">2. Validate</h4>
<h4 id="jax2onnx.user_interface.allclose--provide-concrete-shapes-for-validation-replacing-dynamic-dim-b">Provide concrete shapes for validation (replacing dynamic dim 'B')</h4>
<p>validation_inputs = [(5, 10)]
is_match, msg = allclose(my_func, model_path, inputs=validation_inputs, atol=1e-5)</p>
<p>assert is_match, f"Validation failed: {msg}"</p>
</blockquote>
</blockquote>
</blockquote>
</details>
            <details class="quote">
              <summary>Source code in <code>jax2onnx/user_interface.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">allclose</span><span class="p">(</span>
    <span class="n">fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
    <span class="n">onnx_model_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">inputs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
    <span class="n">input_params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">rtol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-3</span><span class="p">,</span>
    <span class="n">atol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-5</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">enable_double_precision</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks if JAX and ONNX Runtime outputs remain numerically close.</span>

<span class="sd">    Args:</span>
<span class="sd">        fn: JAX callable to compare against the exported ONNX model.</span>
<span class="sd">        onnx_model_path: Path to a serialized model that ORT can execute.</span>
<span class="sd">        inputs: Concrete input arrays (or shape tuples, which will be sampled).</span>
<span class="sd">        input_params: Optional keyword arguments applied to both call sites.</span>
<span class="sd">        rtol: Relative tolerance for floating-point comparisons.</span>
<span class="sd">        atol: Absolute tolerance for floating-point comparisons.</span>
<span class="sd">        enable_double_precision: Temporarily enable `jax_enable_x64` while running the</span>
<span class="sd">            comparison. Defaults to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        `(is_match, message)` where `is_match` indicates success and `message`</span>
<span class="sd">        provides context when a mismatch occurs.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; import jax.numpy as jnp</span>
<span class="sd">        &gt;&gt;&gt; from jax2onnx import to_onnx, allclose</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # 1. Define and Export</span>
<span class="sd">        &gt;&gt;&gt; def my_func(x):</span>
<span class="sd">        ...     return jnp.sin(x)</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; model_path = to_onnx(</span>
<span class="sd">        ...     my_func,</span>
<span class="sd">        ...     inputs=[(&#39;B&#39;, 10)],</span>
<span class="sd">        ...     return_mode=&quot;file&quot;,</span>
<span class="sd">        ...     output_path=&quot;my_model.onnx&quot;</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # 2. Validate</span>
<span class="sd">        &gt;&gt;&gt; # Provide concrete shapes for validation (replacing dynamic dim &#39;B&#39;)</span>
<span class="sd">        &gt;&gt;&gt; validation_inputs = [(5, 10)]</span>
<span class="sd">        &gt;&gt;&gt; is_match, msg = allclose(my_func, model_path, inputs=validation_inputs, atol=1e-5)</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; assert is_match, f&quot;Validation failed: {msg}&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="s2">&quot;Comparing JAX and ONNX outputs (path=</span><span class="si">%s</span><span class="s2">, rtol=</span><span class="si">%s</span><span class="s2">, atol=</span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span>
        <span class="n">onnx_model_path</span><span class="p">,</span>
        <span class="n">rtol</span><span class="p">,</span>
        <span class="n">atol</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_is_shape</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">))</span> <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">x</span>
        <span class="p">)</span>

    <span class="n">xs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">_is_shape</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">):</span>
        <span class="n">xs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">d</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">shape</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">float32</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">shape</span> <span class="ow">in</span> <span class="n">inputs</span>
        <span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>

    <span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">input_params</span> <span class="ow">or</span> <span class="p">{})</span>
    <span class="k">with</span> <span class="n">_temporary_x64</span><span class="p">(</span><span class="n">enable_double_precision</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">jax</span><span class="o">.</span><span class="n">default_matmul_precision</span><span class="p">(</span><span class="s2">&quot;float32&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">_run_allclose</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">onnx_model_path</span><span class="p">,</span> <span class="n">xs</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="n">rtol</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="n">atol</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="jax2onnx.user_interface.onnx_function" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">onnx_function</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Decorator to mark a function or class as an ONNX function.</p>
<p>This decorator is used to indicate that a function or class should be converted to
an ONNX function node when included in a model. It allows the function to be traced
and exported as a reusable component with its own namespace in the ONNX graph.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>target</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="typing.Callable">Callable</span>, <span title="type">type</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The target function or class to decorate. When omitted, the decorator
must be called with parentheses.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>unique</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, reuse a single ONNX Function definition for all call sites
that share the same callable type and captured parameters.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>namespace</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Custom domain prefix for the emitted FunctionProto. Defaults to
<code>"custom"</code> when omitted.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional human-readable base name for the ONNX function. When set,
this overrides the callable's Python name for the function <code>op_type</code>
and FunctionProto name; the domain still derives from <code>namespace</code>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>type</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Alias for <code>name</code>; preferred keyword for setting the function
<code>op_type</code>/display name in ONNX.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="typing.Callable">Callable</span>, <span title="type">type</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The decorated function or class with ONNX function capabilities.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>from jax2onnx import onnx_function
import jax.numpy as jnp</p>
<p>@onnx_function
def my_custom_op(x, y):
...     return jnp.sin(x) * y</p>
<h4 id="jax2onnx.user_interface.onnx_function--also-works-with-flax-modules">Also works with Flax modules:</h4>
<p>from flax import nnx</p>
<p>@onnx_function
class MLPBlock(nnx.Module):
    def <strong>init</strong>(self, features, rngs):
        self.dense = nnx.Linear(features, rngs=rngs)
        self.activation = nnx.relu</p>
<pre><code>def __call__(self, x):
    return self.activation(self.dense(x))
</code></pre>
</blockquote>
</blockquote>
</blockquote>
</details>
            <details class="quote">
              <summary>Source code in <code>jax2onnx/user_interface.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">onnx_function</span><span class="p">(</span>
    <span class="n">target</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Callable</span><span class="p">,</span> <span class="nb">type</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">unique</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">namespace</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="nb">type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># noqa: A002 - user-facing keyword</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Callable</span><span class="p">,</span> <span class="nb">type</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Decorator to mark a function or class as an ONNX function.</span>

<span class="sd">    This decorator is used to indicate that a function or class should be converted to</span>
<span class="sd">    an ONNX function node when included in a model. It allows the function to be traced</span>
<span class="sd">    and exported as a reusable component with its own namespace in the ONNX graph.</span>

<span class="sd">    Args:</span>
<span class="sd">        target: The target function or class to decorate. When omitted, the decorator</span>
<span class="sd">            must be called with parentheses.</span>
<span class="sd">        unique: If True, reuse a single ONNX Function definition for all call sites</span>
<span class="sd">            that share the same callable type and captured parameters.</span>
<span class="sd">        namespace: Custom domain prefix for the emitted FunctionProto. Defaults to</span>
<span class="sd">            ``&quot;custom&quot;`` when omitted.</span>
<span class="sd">        name: Optional human-readable base name for the ONNX function. When set,</span>
<span class="sd">            this overrides the callable&#39;s Python name for the function `op_type`</span>
<span class="sd">            and FunctionProto name; the domain still derives from ``namespace``.</span>
<span class="sd">        type: Alias for ``name``; preferred keyword for setting the function</span>
<span class="sd">            `op_type`/display name in ONNX.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The decorated function or class with ONNX function capabilities.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; from jax2onnx import onnx_function</span>
<span class="sd">        &gt;&gt;&gt; import jax.numpy as jnp</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; @onnx_function</span>
<span class="sd">        &gt;&gt;&gt; def my_custom_op(x, y):</span>
<span class="sd">        ...     return jnp.sin(x) * y</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Also works with Flax modules:</span>
<span class="sd">        &gt;&gt;&gt; from flax import nnx</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; @onnx_function</span>
<span class="sd">        &gt;&gt;&gt; class MLPBlock(nnx.Module):</span>
<span class="sd">        &gt;&gt;&gt;     def __init__(self, features, rngs):</span>
<span class="sd">        &gt;&gt;&gt;         self.dense = nnx.Linear(features, rngs=rngs)</span>
<span class="sd">        &gt;&gt;&gt;         self.activation = nnx.relu</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt;     def __call__(self, x):</span>
<span class="sd">        &gt;&gt;&gt;         return self.activation(self.dense(x))</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Prefer the explicit `type` override; fall back to `name` for BC.</span>
    <span class="n">display</span> <span class="o">=</span> <span class="nb">type</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span> <span class="k">else</span> <span class="n">name</span>
    <span class="k">return</span> <span class="n">onnx_function_impl</span><span class="p">(</span>
        <span class="n">target</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="n">unique</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="n">namespace</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">display</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">display</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="jax2onnx.user_interface.to_onnx" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_onnx</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">input_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="s1">&#39;jax_model&#39;</span><span class="p">,</span> <span class="n">opset</span><span class="o">=</span><span class="mi">21</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">enable_double_precision</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">record_primitive_calls_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_mode</span><span class="o">=</span><span class="s1">&#39;proto&#39;</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>
          <div class="doc-overloads">
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">to_onnx</span><span class="p">(</span>
    <span class="n">fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
    <span class="n">inputs</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">UserInputSpec</span><span class="p">],</span>
    <span class="n">input_params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">object</span><span class="p">]]</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
    <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
    <span class="n">opset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">enable_double_precision</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
    <span class="n">record_primitive_calls_file</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
    <span class="n">return_mode</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;proto&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
    <span class="n">output_path</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="o">...</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">onnx</span><span class="o">.</span><span class="n">ModelProto</span>
</code></pre></div><div class="doc-signature highlight"><pre><span></span><code><span class="nf">to_onnx</span><span class="p">(</span>
    <span class="n">fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
    <span class="n">inputs</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">UserInputSpec</span><span class="p">],</span>
    <span class="n">input_params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">object</span><span class="p">]]</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
    <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
    <span class="n">opset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">enable_double_precision</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
    <span class="n">record_primitive_calls_file</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
    <span class="n">return_mode</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;ir&quot;</span><span class="p">],</span>
    <span class="n">output_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PathLikeStr</span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ir</span><span class="o">.</span><span class="n">Model</span>
</code></pre></div><div class="doc-signature highlight"><pre><span></span><code><span class="nf">to_onnx</span><span class="p">(</span>
    <span class="n">fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
    <span class="n">inputs</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">UserInputSpec</span><span class="p">],</span>
    <span class="n">input_params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">object</span><span class="p">]]</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
    <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
    <span class="n">opset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">enable_double_precision</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
    <span class="n">record_primitive_calls_file</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
    <span class="n">return_mode</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;file&quot;</span><span class="p">],</span>
    <span class="n">output_path</span><span class="p">:</span> <span class="n">PathLikeStr</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span>
</code></pre></div>          </div>


    <div class="doc doc-contents ">

        <p>Converts a JAX function or model into an ONNX model.</p>
<p>This function serves as the main entry point for converting JAX/Flax models to ONNX format.
It supports dynamic shapes and additional runtime parameters.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>fn</code>
            </td>
            <td>
                  <code><span title="typing.Callable">Callable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The JAX function or Flax module to convert.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>inputs</code>
            </td>
            <td>
                  <code><span title="typing.Sequence">Sequence</span>[<span title="jax2onnx.user_interface.UserInputSpec">UserInputSpec</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sequence of input specifications. Each entry may be:
* a <code>jax.ShapeDtypeStruct</code> (or <code>jax.core.ShapedArray</code>);
* any array-like object exposing <code>.shape</code> and <code>.dtype</code>
  (e.g. <code>jax.Array</code>, <code>np.ndarray</code>);
* a tuple/list of ints/strs describing the desired shape.
  Example: <code>[('B', 128), (1, 10)]</code> implies two inputs, the first with a dynamic batch dimension 'B' and fixed size 128.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>input_params</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Mapping">Mapping</span>[<span title="str">str</span>, <span title="object">object</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional mapping of string keys to runtime parameters that
should be exposed as inputs in the ONNX model rather than baked into
the export (e.g. <code>"deterministic"</code> flags).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>model_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name to give the ONNX model. Defaults to "jax_model".</p>
              </div>
            </td>
            <td>
                  <code>&#39;jax_model&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>opset</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ONNX opset version to target. Defaults to 21.</p>
              </div>
            </td>
            <td>
                  <code>21</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>enable_double_precision</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, export tensors as tensor(double). Defaults to False (use tensor(float)).</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>record_primitive_calls_file</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional path to a file. If provided,
details of each JAX primitive encountered during conversion will be
recorded to this file. This log can be used by developers to manually
create new test cases. Defaults to None (disabled).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_mode</code>
            </td>
            <td>
                  <code><span title="jax2onnx.user_interface.ReturnMode">ReturnMode</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Output mode. <code>"proto"</code> (default) returns an ONNX ModelProto,
<code>"ir"</code> returns the intermediate onnx_ir.Model, and <code>"file"</code>
serialises directly to disk.</p>
              </div>
            </td>
            <td>
                  <code>&#39;proto&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>output_path</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="jax2onnx.user_interface.PathLikeStr">PathLikeStr</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Destination path (str or PathLike) required when <code>return_mode</code> is
<code>"file"</code>. Ignored otherwise.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="onnx.ModelProto">ModelProto</span>, <span title="onnx_ir.Model">Model</span>, <span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>If <code>return_mode="proto"</code> (default): Returns an <code>onnx.ModelProto</code> object.</li>
</ul>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="onnx.ModelProto">ModelProto</span>, <span title="onnx_ir.Model">Model</span>, <span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>If <code>return_mode="ir"</code>: Returns an <code>onnx_ir.Model</code> object (intermediate representation).</li>
</ul>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="onnx.ModelProto">ModelProto</span>, <span title="onnx_ir.Model">Model</span>, <span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>If <code>return_mode="file"</code>: Returns the string path to the saved file.</li>
</ul>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>return_mode</code> is "file" but <code>output_path</code> is not provided.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>return_mode</code> is invalid.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="TypeError">TypeError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>input_params</code> keys are not strings.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>import jax
import jax.numpy as jnp
from jax2onnx import to_onnx</p>
<h4 id="jax2onnx.user_interface.to_onnx--define-a-simple-jax-function">Define a simple JAX function</h4>
<p>def linear(x, w, b):
...     return jnp.dot(x, w) + b</p>
<h4 id="jax2onnx.user_interface.to_onnx--define-input-shapes-b-indicates-a-dynamic-batch-dimension">Define input shapes: 'B' indicates a dynamic batch dimension</h4>
<p>input_specs = [
...     ('B', 32),  # x: [Batch, 32]
...     (32, 10),   # w: [32, 10]
...     (10,)       # b: [10]
... ]</p>
<h4 id="jax2onnx.user_interface.to_onnx--convert-and-save-to-file-directly-recommended">Convert and save to file directly (Recommended)</h4>
<p>to_onnx(
...     linear,
...     inputs=input_specs,
...     model_name="linear_model",
...     return_mode="file",
...     output_path="linear_model.onnx"
... )</p>
</blockquote>
</blockquote>
</blockquote>
</details>
            <details class="quote">
              <summary>Source code in <code>jax2onnx/user_interface.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">to_onnx</span><span class="p">(</span>
    <span class="n">fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
    <span class="n">inputs</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">UserInputSpec</span><span class="p">],</span>
    <span class="n">input_params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">object</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;jax_model&quot;</span><span class="p">,</span>
    <span class="n">opset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">21</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>  <span class="c1"># All arguments after this must be keyword-only</span>
    <span class="n">enable_double_precision</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">record_primitive_calls_file</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">return_mode</span><span class="p">:</span> <span class="n">ReturnMode</span> <span class="o">=</span> <span class="s2">&quot;proto&quot;</span><span class="p">,</span>
    <span class="n">output_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PathLikeStr</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">onnx</span><span class="o">.</span><span class="n">ModelProto</span><span class="p">,</span> <span class="n">ir</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts a JAX function or model into an ONNX model.</span>

<span class="sd">    This function serves as the main entry point for converting JAX/Flax models to ONNX format.</span>
<span class="sd">    It supports dynamic shapes and additional runtime parameters.</span>

<span class="sd">    Args:</span>
<span class="sd">        fn: The JAX function or Flax module to convert.</span>
<span class="sd">        inputs: Sequence of input specifications. Each entry may be:</span>
<span class="sd">            * a `jax.ShapeDtypeStruct` (or `jax.core.ShapedArray`);</span>
<span class="sd">            * any array-like object exposing `.shape` and `.dtype`</span>
<span class="sd">              (e.g. `jax.Array`, `np.ndarray`);</span>
<span class="sd">            * a tuple/list of ints/strs describing the desired shape.</span>
<span class="sd">              Example: `[(&#39;B&#39;, 128), (1, 10)]` implies two inputs, the first with a dynamic batch dimension &#39;B&#39; and fixed size 128.</span>
<span class="sd">        input_params: Optional mapping of string keys to runtime parameters that</span>
<span class="sd">            should be exposed as inputs in the ONNX model rather than baked into</span>
<span class="sd">            the export (e.g. `&quot;deterministic&quot;` flags).</span>
<span class="sd">        model_name: Name to give the ONNX model. Defaults to &quot;jax_model&quot;.</span>
<span class="sd">        opset: ONNX opset version to target. Defaults to 21.</span>
<span class="sd">        enable_double_precision: If True, export tensors as tensor(double). Defaults to False (use tensor(float)).</span>
<span class="sd">        record_primitive_calls_file: Optional path to a file. If provided,</span>
<span class="sd">            details of each JAX primitive encountered during conversion will be</span>
<span class="sd">            recorded to this file. This log can be used by developers to manually</span>
<span class="sd">            create new test cases. Defaults to None (disabled).</span>
<span class="sd">        return_mode: Output mode. `&quot;proto&quot;` (default) returns an ONNX ModelProto,</span>
<span class="sd">            `&quot;ir&quot;` returns the intermediate onnx_ir.Model, and `&quot;file&quot;`</span>
<span class="sd">            serialises directly to disk.</span>
<span class="sd">        output_path: Destination path (str or PathLike) required when `return_mode` is</span>
<span class="sd">            `&quot;file&quot;`. Ignored otherwise.</span>

<span class="sd">    Returns:</span>
<span class="sd">        * If `return_mode=&quot;proto&quot;` (default): Returns an `onnx.ModelProto` object.</span>
<span class="sd">        * If `return_mode=&quot;ir&quot;`: Returns an `onnx_ir.Model` object (intermediate representation).</span>
<span class="sd">        * If `return_mode=&quot;file&quot;`: Returns the string path to the saved file.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If `return_mode` is &quot;file&quot; but `output_path` is not provided.</span>
<span class="sd">        ValueError: If `return_mode` is invalid.</span>
<span class="sd">        TypeError: If `input_params` keys are not strings.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; import jax</span>
<span class="sd">        &gt;&gt;&gt; import jax.numpy as jnp</span>
<span class="sd">        &gt;&gt;&gt; from jax2onnx import to_onnx</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Define a simple JAX function</span>
<span class="sd">        &gt;&gt;&gt; def linear(x, w, b):</span>
<span class="sd">        ...     return jnp.dot(x, w) + b</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Define input shapes: &#39;B&#39; indicates a dynamic batch dimension</span>
<span class="sd">        &gt;&gt;&gt; input_specs = [</span>
<span class="sd">        ...     (&#39;B&#39;, 32),  # x: [Batch, 32]</span>
<span class="sd">        ...     (32, 10),   # w: [32, 10]</span>
<span class="sd">        ...     (10,)       # b: [10]</span>
<span class="sd">        ... ]</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Convert and save to file directly (Recommended)</span>
<span class="sd">        &gt;&gt;&gt; to_onnx(</span>
<span class="sd">        ...     linear,</span>
<span class="sd">        ...     inputs=input_specs,</span>
<span class="sd">        ...     model_name=&quot;linear_model&quot;,</span>
<span class="sd">        ...     return_mode=&quot;file&quot;,</span>
<span class="sd">        ...     output_path=&quot;linear_model.onnx&quot;</span>
<span class="sd">        ... )</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Converting JAX function to ONNX model with parameters: &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;model_name=</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">, opset=</span><span class="si">{</span><span class="n">opset</span><span class="si">}</span><span class="s2">, input_shapes=</span><span class="si">{</span><span class="n">inputs</span><span class="si">}</span><span class="s2">, &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;input_params=</span><span class="si">{</span><span class="n">input_params</span><span class="si">}</span><span class="s2">, &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;enable_double_precision=</span><span class="si">{</span><span class="n">enable_double_precision</span><span class="si">}</span><span class="s2">, &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;record_primitive_calls_file=</span><span class="si">{</span><span class="n">record_primitive_calls_file</span><span class="si">}</span><span class="s2">, &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;return_mode=</span><span class="si">{</span><span class="n">return_mode</span><span class="si">}</span><span class="s2">, output_path=</span><span class="si">{</span><span class="n">output_path</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Determine the nature of the &#39;inputs&#39; argument to prepare for to_onnx_impl</span>
    <span class="n">normalized_mode</span> <span class="o">=</span> <span class="n">_normalize_return_mode</span><span class="p">(</span><span class="n">return_mode</span><span class="p">)</span>

    <span class="n">file_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">normalized_mode</span> <span class="o">==</span> <span class="s2">&quot;file&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">output_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;`output_path` must be provided when return_mode is &#39;file&#39;.&quot;</span>
            <span class="p">)</span>
        <span class="n">path_value</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">fspath</span><span class="p">(</span><span class="n">output_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path_value</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
            <span class="n">path_value</span> <span class="o">=</span> <span class="n">path_value</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">path_value</span><span class="p">)</span>

    <span class="n">normalized_inputs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">InputSpec</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">inputs</span><span class="p">:</span>
        <span class="n">normalized_inputs</span> <span class="o">=</span> <span class="n">_normalize_input_specs</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>

    <span class="n">param_map</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">object</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">input_params</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">input_params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="s2">&quot;input_params must use string keys; &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;received key of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
                <span class="p">)</span>
            <span class="n">param_map</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">with</span> <span class="n">_temporary_x64</span><span class="p">(</span><span class="n">enable_double_precision</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">to_onnx_impl</span><span class="p">(</span>
            <span class="n">fn</span><span class="o">=</span><span class="n">fn</span><span class="p">,</span>
            <span class="n">inputs</span><span class="o">=</span><span class="n">normalized_inputs</span><span class="p">,</span>
            <span class="n">input_params</span><span class="o">=</span><span class="n">param_map</span><span class="p">,</span>
            <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span>
            <span class="n">opset</span><span class="o">=</span><span class="n">opset</span><span class="p">,</span>
            <span class="n">enable_double_precision</span><span class="o">=</span><span class="n">enable_double_precision</span><span class="p">,</span>
            <span class="n">record_primitive_calls_file</span><span class="o">=</span><span class="n">record_primitive_calls_file</span><span class="p">,</span>
            <span class="n">protective_clone</span><span class="o">=</span><span class="p">(</span><span class="n">normalized_mode</span> <span class="o">==</span> <span class="s2">&quot;ir&quot;</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="n">postprocess_ir_model</span><span class="p">(</span>
            <span class="n">result</span><span class="p">,</span>
            <span class="n">promote_to_double</span><span class="o">=</span><span class="n">enable_double_precision</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_save_model_proto</span><span class="p">(</span>
        <span class="n">model_proto</span><span class="p">:</span> <span class="n">onnx</span><span class="o">.</span><span class="n">ModelProto</span><span class="p">,</span>
        <span class="n">dest</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">external_threshold</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1_048_576</span><span class="p">,</span>  <span class="c1"># 1 MB default before spilling to .data</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">dest_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">dest</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dest_dir</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dest_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">data_location</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">dest</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.data&quot;</span>
        <span class="n">data_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dest_dir</span> <span class="ow">or</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">data_location</span><span class="p">)</span>
        <span class="n">onnx</span><span class="o">.</span><span class="n">save_model</span><span class="p">(</span>
            <span class="n">model_proto</span><span class="p">,</span>
            <span class="n">dest</span><span class="p">,</span>
            <span class="n">save_as_external_data</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">all_tensors_to_one_file</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">location</span><span class="o">=</span><span class="n">data_location</span><span class="p">,</span>
            <span class="n">size_threshold</span><span class="o">=</span><span class="n">external_threshold</span><span class="p">,</span>
            <span class="n">convert_attribute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># Only keep the .data sidecar if the export actually referenced external data.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">init</span><span class="o">.</span><span class="n">external_data</span> <span class="k">for</span> <span class="n">init</span> <span class="ow">in</span> <span class="n">model_proto</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">initializer</span><span class="p">):</span>
            <span class="c1"># No external payloads; remove an empty sidecar if one was produced.</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">data_path</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">data_path</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">data_path</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">return</span> <span class="n">dest</span>

    <span class="n">_materialize_input_params_on_ir</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">param_map</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">normalized_mode</span> <span class="o">==</span> <span class="s2">&quot;ir&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="n">model_proto</span> <span class="o">=</span> <span class="n">ir</span><span class="o">.</span><span class="n">to_proto</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">normalized_mode</span> <span class="o">==</span> <span class="s2">&quot;file&quot;</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">file_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">_save_model_proto</span><span class="p">(</span><span class="n">model_proto</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">model_proto</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.indexes", "navigation.sections", "navigation.expand", "content.code.copy"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>